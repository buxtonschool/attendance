<!DOCTYPE html> 
<html> 
	<head> 
    <title>Google Spreadsheet Javascript</title> 
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
    <script>
    	var GoogleSpreadsheet, GoogleUrl;
    	GoogleUrl = (function() {
    	  function GoogleUrl(sourceIdentifier) {
    	    this.sourceIdentifier = sourceIdentifier;
    	    if (this.sourceIdentifier.match(/http(s)*:/)) {
    	      this.url = this.sourceIdentifier;
    	      try {
    	        this.key = this.url.match(/key=(.*?)&/)[1];
    	      } catch (error) {
    	        this.key = this.url.match(/(cells|list)\/(.*?)\//)[2];
    	      }
    	    } else {
    	      this.key = this.sourceIdentifier;
    	    }
    	    this.jsonCellsUrl = "https://spreadsheets.google.com/feeds/cells/" + this.key + "/od6/public/basic?alt=json-in-script";
    	    this.jsonListUrl = "https://spreadsheets.google.com/feeds/list/" + this.key + "/od6/public/basic?alt=json-in-script";
    	    this.jsonUrl = this.jsonCellsUrl;
    	  }
    	  return GoogleUrl;
    	})();
    	GoogleSpreadsheet = (function() {
    	  function GoogleSpreadsheet() {}
    	  GoogleSpreadsheet.prototype.load = function(callback) {
    	    var intervalId, jsonUrl, safetyCounter, url, waitUntilLoaded;
    	    url = this.googleUrl.jsonCellsUrl + "&callback=GoogleSpreadsheet.callbackCells";
    	    $('body').append("<script src='" + url + "'/>");
    	    jsonUrl = this.jsonUrl;
    	    safetyCounter = 0;
    	    waitUntilLoaded = function() {
    	      var result;
    	      result = GoogleSpreadsheet.find({
    	        jsonUrl: jsonUrl
    	      });
    	      if (safetyCounter++ > 20 || ((result != null) && (result.data != null))) {
    	        clearInterval(intervalId);
    	        return callback(result);
    	      }
    	    };
    	    intervalId = setInterval(waitUntilLoaded, 200);
    	    if (typeof result != "undefined" && result !== null) {
    	      return result;
    	    }
    	  };
    	  GoogleSpreadsheet.prototype.url = function(url) {
    	    return this.googleUrl(new GoogleUrl(url));
    	  };
    	  GoogleSpreadsheet.prototype.googleUrl = function(googleUrl) {
    	    if (typeof googleUrl === "string") {
    	      throw "Invalid url, expecting object not string";
    	    }
    	    this.url = googleUrl.url;
    	    this.key = googleUrl.key;
    	    this.jsonUrl = googleUrl.jsonUrl;
    	    return this.googleUrl = googleUrl;
    	  };
    	  GoogleSpreadsheet.prototype.save = function() {
    	    return localStorage["GoogleSpreadsheet." + this.type] = JSON.stringify(this);
    	  };
    	  return GoogleSpreadsheet;
    	})();
    	GoogleSpreadsheet.bless = function(object) {
    	  var key, result, value;
    	  result = new GoogleSpreadsheet();
    	  for (key in object) {
    	    value = object[key];
    	    result[key] = value;
    	  }
    	  return result;
    	};
    	GoogleSpreadsheet.find = function(params) {
    	  var item, itemObject, key, value, _i, _len;
    	  try {
    	    for (item in localStorage) {
    	      if (item.match(/^GoogleSpreadsheet\./)) {
    	        itemObject = JSON.parse(localStorage[item]);
    	        for (key in params) {
    	          value = params[key];
    	          if (itemObject[key] === value) {
    	            return GoogleSpreadsheet.bless(itemObject);
    	          }
    	        }
    	      }
    	    }
    	  } catch (error) {
    	    for (_i = 0, _len = localStorage.length; _i < _len; _i++) {
    	      item = localStorage[_i];
    	      if (item.match(/^GoogleSpreadsheet\./)) {
    	        itemObject = JSON.parse(localStorage[item]);
    	        for (key in params) {
    	          value = params[key];
    	          if (itemObject[key] === value) {
    	            return GoogleSpreadsheet.bless(itemObject);
    	          }
    	        }
    	      }
    	    }
    	  }
    	  return null;
    	};
    	GoogleSpreadsheet.callbackCells = function(data) {
    	  var cell, googleSpreadsheet, googleUrl;
    	  googleUrl = new GoogleUrl(data.feed.id.$t);
    	  googleSpreadsheet = GoogleSpreadsheet.find({
    	    jsonUrl: googleUrl.jsonUrl
    	  });
    	  if (googleSpreadsheet === null) {
    	    googleSpreadsheet = new GoogleSpreadsheet();
    	    googleSpreadsheet.googleUrl(googleUrl);
    	  }
    	  googleSpreadsheet.data = (function() {
    	    var _i, _len, _ref, _results;
    	    _ref = data.feed.entry;
    	    _results = [];
    	    for (_i = 0, _len = _ref.length; _i < _len; _i++) {
    	      cell = _ref[_i];
    	      _results.push(cell.content.$t);
    	    }
    	    return _results;
    	  })();
    	  googleSpreadsheet.save();
    	  return googleSpreadsheet;
    	};
    </script>
    <style>
      body{
        background-color: black;
        color: green;
        font-size: .8em;
        font-family: sans-serif;
      }
      h1,a{ color: yellow}
      input{
        font-size: .8em;
        background-color: black;
        color:white;
      }
    </style>
  </head> 
  <body> 
    <h1>Google Spreadsheet Javascript</h1>
    Here is the most basic usage:
    <pre id='code'></pre>
    And here are the results:
    <pre id='results'></pre>
    <div id='links'>
      Github URL: <a href='https://github.com/mikeymckay/google-spreadsheet-javascript'>https://github.com/mikeymckay/google-spreadsheet-javascript</a><br/>
      Source URL for above spreadsheet data: <span id='spreadsheet_url'></span><br/>
      Try your own spreadsheet (needs to be <a href='https://docs.google.com/support/bin/answer.py?hl=en&answer=47134'>published</a>):<br/>
      <input style='width:700px' name='url' type='text'></input>
      <input onclick='document.location = document.location.pathname + "?url="+$("input[name]").val()' type='submit'></input>
    </div>
    <iframe width='500' height='300' frameborder='0' ></iframe>
    <script>

    </script>
    <script id='script'>

      localStorage.clear();
      var sample_url = "https://spreadsheets.google.com/pub?key=0Ago31JQPZxZrdHF2bWNjcTJFLXJ6UUM5SldEakdEaXc&hl=en&output=html";
      var url_parameter = document.location.search.split(/\?url=/)[1]
      var url = url_parameter || sample_url;
      var googleSpreadsheet = new GoogleSpreadsheet();
      googleSpreadsheet.url(url);
      googleSpreadsheet.load(function(result) {
        $('#results').html(JSON.stringify(result).replace(/,/g,",\n"));
      });
    </script>
    <script>
      $('#code').html($('#script').html())
      $('#spreadsheet_url').html("<a href='"+url+"'>"+url+"</a>");
      $('#iframe').attr("src",url);
      $('input[name]').val(url);
      if (url != sample_url){
        $("div#links").append("<br/><a href='"+document.location.pathname+"'>Original Sample Spreadsheet</a>")
      }
    </script>
  </body>
</html>